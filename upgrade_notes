2021-01-13 01:36

# running php upgrade upgrade see: https://github.com/silverstripe/silverstripe-upgrader
cd /var/www/ss3/upgrades/trademe
php /var/www/ss3/upgrader/vendor/silverstripe/upgrader/bin/upgrade-code upgrade /var/www/ss3/upgrades/trademe/ecommerce_trademe  --root-dir=/var/www/ss3/upgrades/trademe --write -vvv
Writing changes for 14 files
Running upgrades on "/var/www/ss3/upgrades/trademe/ecommerce_trademe"
[2021-01-13 13:36:40] Applying RenameClasses to EcommerceTrademeTest.php...
[2021-01-13 13:36:40] Applying ClassToTraitRule to EcommerceTrademeTest.php...
[2021-01-13 13:36:40] Applying RenameClasses to CsvFunctionality.php...
[2021-01-13 13:36:40] Applying ClassToTraitRule to CsvFunctionality.php...
[2021-01-13 13:36:40] Applying RenameClasses to TradeMeCategories.php...
[2021-01-13 13:36:40] Applying ClassToTraitRule to TradeMeCategories.php...
[2021-01-13 13:36:40] Applying RenameClasses to TradeMeGenericCmsFieldsProvider.php...
[2021-01-13 13:36:40] Applying ClassToTraitRule to TradeMeGenericCmsFieldsProvider.php...
[2021-01-13 13:36:40] Applying RenameClasses to TradeMeAssignProductController.php...
[2021-01-13 13:36:40] Applying ClassToTraitRule to TradeMeAssignProductController.php...
[2021-01-13 13:36:40] Applying RenameClasses to TradeMeAssignGroupController.php...
[2021-01-13 13:36:40] Applying ClassToTraitRule to TradeMeAssignGroupController.php...
[2021-01-13 13:36:40] Applying RenameClasses to CreateTradeMeCsvTask.php...
[2021-01-13 13:36:40] Applying ClassToTraitRule to CreateTradeMeCsvTask.php...
[2021-01-13 13:36:40] Applying RenameClasses to ExportToTradeMeTask.php...
[2021-01-13 13:36:40] Applying ClassToTraitRule to ExportToTradeMeTask.php...
[2021-01-13 13:36:40] Applying RenameClasses to ResetTradeMeTaskHard.php...
[2021-01-13 13:36:40] Applying ClassToTraitRule to ResetTradeMeTaskHard.php...
[2021-01-13 13:36:40] Applying RenameClasses to ResetTradeMeTask.php...
[2021-01-13 13:36:40] Applying ClassToTraitRule to ResetTradeMeTask.php...
[2021-01-13 13:36:40] Applying RenameClasses to EcommerceConfigTradeMeExtension.php...
[2021-01-13 13:36:40] Applying ClassToTraitRule to EcommerceConfigTradeMeExtension.php...
[2021-01-13 13:36:40] Applying RenameClasses to ProductGroupTradeMeExtension.php...
[2021-01-13 13:36:40] Applying ClassToTraitRule to ProductGroupTradeMeExtension.php...
[2021-01-13 13:36:40] Applying RenameClasses to ProductTradeMeExtension.php...
[2021-01-13 13:36:40] Applying ClassToTraitRule to ProductTradeMeExtension.php...
[2021-01-13 13:36:40] Applying UpdateConfigClasses to config.yml...
[2021-01-13 13:36:40] Applying UpdateConfigClasses to routes.yml...
modified:	tests/EcommerceTrademeTest.php
@@ -1,4 +1,6 @@
 <?php
+
+use SilverStripe\Dev\SapphireTest;

 class EcommerceTrademeTest extends SapphireTest
 {

modified:	src/Api/TradeMeCategories.php
@@ -2,11 +2,18 @@

 namespace Sunnysideup\EcommerceTrademe\Api;

-use ViewableData;
-use Config;
-use DropdownField;
-use ReadonlyField;
-use HiddenField;
+
+
+
+
+
+use SilverStripe\Core\Config\Config;
+use Sunnysideup\EcommerceTrademe\Api\TradeMeCategories;
+use SilverStripe\Forms\DropdownField;
+use SilverStripe\Forms\ReadonlyField;
+use SilverStripe\Forms\HiddenField;
+use SilverStripe\View\ViewableData;
+



@@ -36,14 +43,14 @@

     public static function get_categories(): array
     {
-        return Config::inst()->get('TradeMeCategories', 'trade_me_categories');
+        return Config::inst()->get(TradeMeCategories::class, 'trade_me_categories');
     }

     public static function get_title_from_id($categoryID): string
     {
         $array = self::get_categories();
         if(! $categoryID) {
-            $categoryID = Config::inst()->get('TradeMeCategories', 'trade_me_default');
+            $categoryID = Config::inst()->get(TradeMeCategories::class, 'trade_me_default');
         }
         return $array[$categoryID] ?? 'unknown category';
     }

modified:	src/Api/TradeMeGenericCmsFieldsProvider.php
@@ -2,11 +2,17 @@

 namespace Sunnysideup\EcommerceTrademe\Api;

-use ReadonlyField;
-use DBField;
-use TradeMeAssignProductController;
-use Config;
-use TradeMeAssignGroupController;
+
+
+
+
+
+use Sunnysideup\EcommerceTrademe\Control\TradeMeAssignProductController;
+use SilverStripe\ORM\FieldType\DBField;
+use SilverStripe\Forms\ReadonlyField;
+use SilverStripe\Core\Config\Config;
+use Sunnysideup\EcommerceTrademe\Control\TradeMeAssignGroupController;
+


 class TradeMeGenericCmsFieldsProvider
@@ -41,7 +47,7 @@

         }

-        $link = '/dev/tasks/'. Config::inst()->get('TradeMeAssignGroupController', 'create_trademe_csv_task_class_name');
+        $link = '/dev/tasks/'. Config::inst()->get(TradeMeAssignGroupController::class, 'create_trademe_csv_task_class_name');

         $ar = [
             ReadonlyField::create(
@@ -58,7 +64,7 @@
                 'Export',
                 DBField::create_field(
                     'HTMLText',
-                    '<a href="dev/tasks/'.Config::inst()->get('TradeMeAssignGroupController', 'create_trademe_csv_task_class_name').'">Export to TradeMe</a>'
+                    '<a href="dev/tasks/'.Config::inst()->get(TradeMeAssignGroupController::class, 'create_trademe_csv_task_class_name').'">Export to TradeMe</a>'
                 )
             ),
         ];

modified:	src/Control/TradeMeAssignProductController.php
@@ -2,18 +2,31 @@

 namespace Sunnysideup\EcommerceTrademe\Control;

-use FieldList;
-use OptionsetField;
-use ReadonlyField;
-use DBField;
-use TradeMeCategories;
-use LiteralField;
-use Form;
-use DataObject;
-use Product;
-use DataList;
-use Config;
-use ProductGroup;
+
+
+
+
+
+
+
+
+
+
+
+
+use SilverStripe\Forms\FieldList;
+use SilverStripe\Forms\OptionsetField;
+use SilverStripe\ORM\FieldType\DBField;
+use SilverStripe\Forms\ReadonlyField;
+use Sunnysideup\EcommerceTrademe\Api\TradeMeCategories;
+use SilverStripe\Forms\LiteralField;
+use SilverStripe\Forms\Form;
+use Sunnysideup\Ecommerce\Pages\Product;
+use SilverStripe\ORM\DataObject;
+use SilverStripe\Core\Config\Config;
+use Sunnysideup\EcommerceTrademe\Control\TradeMeAssignProductController;
+use Sunnysideup\Ecommerce\Pages\ProductGroup;
+


 class TradeMeAssignProductController extends TradeMeAssignGroupController
@@ -73,7 +86,7 @@

         $actions = $this->getFormActions();

-        $form = new Form($this, 'Form', $fields, $actions);
+        $form = new Form($this, Form::class, $fields, $actions);

         return $form;
     }
@@ -103,7 +116,7 @@
     public static function base_list() :DataList
     {
         $list = Product::get()->filter(['AllowPurchase' => true]);
-        $filter = Config::inst()->get('TradeMeAssignProductController', 'product_filter');
+        $filter = Config::inst()->get(TradeMeAssignProductController::class, 'product_filter');
         if(! empty($filter)) {
             $list = $list->filter($filter);
         }

Warnings for src/Control/TradeMeAssignProductController.php:
 - src/Control/TradeMeAssignProductController.php:76 Renaming ambiguous string Form to SilverStripe\Forms\Form

modified:	src/Control/TradeMeAssignGroupController.php
@@ -2,29 +2,53 @@

 namespace Sunnysideup\EcommerceTrademe\Control;

-use Controller;
-use PermissionProvider;
-use CreateTradeMeCsvTask;
-use Permission;
-use Security;
-use DataObject;
-use ProductGroup;
-use Director;
-use Config;
-use PaginatedList;
-use DataList;
-use FieldList;
-use CompositeField;
-use OptionsetField;
-use ReadonlyField;
-use DBField;
-use TradeMeCategories;
-use LiteralField;
-use Form;
-use FormAction;
-use HiddenField;
-use ArrayList;
-use ArrayData;
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+use Sunnysideup\EcommerceTrademe\Tasks\CreateTradeMeCsvTask;
+use SilverStripe\Security\Permission;
+use SilverStripe\Security\Security;
+use Sunnysideup\Ecommerce\Pages\ProductGroup;
+use SilverStripe\ORM\DataObject;
+use SilverStripe\Control\Director;
+use SilverStripe\Core\Config\Config;
+use SilverStripe\Control\Controller;
+use SilverStripe\ORM\PaginatedList;
+use Sunnysideup\EcommerceTrademe\Control\TradeMeAssignGroupController;
+use SilverStripe\Forms\FieldList;
+use SilverStripe\Forms\CompositeField;
+use SilverStripe\Forms\OptionsetField;
+use SilverStripe\ORM\FieldType\DBField;
+use SilverStripe\Forms\ReadonlyField;
+use Sunnysideup\EcommerceTrademe\Api\TradeMeCategories;
+use SilverStripe\Forms\LiteralField;
+use SilverStripe\Forms\Form;
+use SilverStripe\Forms\FormAction;
+use SilverStripe\Forms\HiddenField;
+use SilverStripe\ORM\ArrayList;
+use SilverStripe\View\ArrayData;
+use SilverStripe\Security\PermissionProvider;
+


 class TradeMeAssignGroupController extends Controller implements PermissionProvider
@@ -163,7 +187,7 @@
     public static function base_list() : DataList
     {
         $list = ProductGroup::get();
-        $filter = Config::inst()->get('TradeMeAssignGroupController', 'group_filter');
+        $filter = Config::inst()->get(TradeMeAssignGroupController::class, 'group_filter');
         if(! empty($filter)) {
             $list = $list->filter($filter);
         }
@@ -225,7 +249,7 @@

         $actions = $this->getFormActions();

-        $form = new Form($this, 'Form', $fields, $actions);
+        $form = new Form($this, Form::class, $fields, $actions);

         return $form;
     }

Warnings for src/Control/TradeMeAssignGroupController.php:
 - src/Control/TradeMeAssignGroupController.php:228 Renaming ambiguous string Form to SilverStripe\Forms\Form

modified:	src/Tasks/CreateTradeMeCsvTask.php
@@ -2,11 +2,17 @@

 namespace Sunnysideup\EcommerceTrademe\Tasks;

-use BuildTask;
-use CsvFunctionality;
-use Director;
-use TradeMeAssignProductController;
-use DB;
+
+
+
+
+
+use Sunnysideup\EcommerceTrademe\Api\CsvFunctionality;
+use SilverStripe\Control\Director;
+use Sunnysideup\EcommerceTrademe\Control\TradeMeAssignProductController;
+use SilverStripe\ORM\DB;
+use SilverStripe\Dev\BuildTask;
+




Warnings for src/Tasks/CreateTradeMeCsvTask.php:
 - src/Tasks/CreateTradeMeCsvTask.php:274 PhpParser\Node\NullableType
 - WARNING: New class instantiated by a dynamic value on line 274

modified:	src/Tasks/ExportToTradeMeTask.php
@@ -2,9 +2,13 @@

 namespace Sunnysideup\EcommerceTrademe\Tasks;

-use BuildTask;
-use Director;
-use Filesystem;
+
+
+
+use SilverStripe\Control\Director;
+use SilverStripe\Assets\Filesystem;
+use SilverStripe\Dev\BuildTask;
+




modified:	src/Tasks/ResetTradeMeTaskHard.php
@@ -2,8 +2,11 @@

 namespace Sunnysideup\EcommerceTrademe\Tasks;

-use BuildTask;
-use DB;
+
+
+use SilverStripe\ORM\DB;
+use SilverStripe\Dev\BuildTask;
+




modified:	src/Tasks/ResetTradeMeTask.php
@@ -2,8 +2,11 @@

 namespace Sunnysideup\EcommerceTrademe\Tasks;

-use BuildTask;
-use DB;
+
+
+use SilverStripe\ORM\DB;
+use SilverStripe\Dev\BuildTask;
+




modified:	src/Extensions/EcommerceConfigTradeMeExtension.php
@@ -2,10 +2,15 @@

 namespace Sunnysideup\EcommerceTrademe\Extensions;

-use DataExtension;
-use FieldList;
-use TextareaField;
-use TradeMeGenericCmsFieldsProvider;
+
+
+
+
+use SilverStripe\Forms\FieldList;
+use SilverStripe\Forms\TextareaField;
+use Sunnysideup\EcommerceTrademe\Api\TradeMeGenericCmsFieldsProvider;
+use SilverStripe\ORM\DataExtension;
+

 /**
  * EcommerceRole provides customisations to the {@link Member}

modified:	src/Extensions/ProductGroupTradeMeExtension.php
@@ -2,13 +2,20 @@

 namespace Sunnysideup\EcommerceTrademe\Extensions;

-use DataExtension;
-use FieldList;
-use OptionsetField;
-use TradeMeCategories;
-use TradeMeGenericCmsFieldsProvider;
+
+
+
+
+
 use int;
-use ProductGroup;
+
+use SilverStripe\Forms\FieldList;
+use SilverStripe\Forms\OptionsetField;
+use Sunnysideup\EcommerceTrademe\Api\TradeMeCategories;
+use Sunnysideup\EcommerceTrademe\Api\TradeMeGenericCmsFieldsProvider;
+use Sunnysideup\Ecommerce\Pages\ProductGroup;
+use SilverStripe\ORM\DataExtension;
+

 /**
  * Product Group is a 'holder' for Products within the CMS

modified:	src/Extensions/ProductTradeMeExtension.php
@@ -2,15 +2,27 @@

 namespace Sunnysideup\EcommerceTrademe\Extensions;

-use Extension;
-use FieldList;
-use OptionsetField;
-use TradeMeCategories;
-use UploadField;
-use TradeMeGenericCmsFieldsProvider;
-use ProductGroup;
-use Config;
-use EcommerceDBConfig;
+
+
+
+
+
+
+
+
+
+use SilverStripe\Assets\Image;
+use SilverStripe\Forms\FieldList;
+use SilverStripe\Forms\OptionsetField;
+use Sunnysideup\EcommerceTrademe\Api\TradeMeCategories;
+use SilverStripe\AssetAdmin\Forms\UploadField;
+use Sunnysideup\EcommerceTrademe\Api\TradeMeGenericCmsFieldsProvider;
+use Sunnysideup\Ecommerce\Pages\ProductGroup;
+use SilverStripe\Core\Config\Config;
+use Sunnysideup\EcommerceTrademe\Extensions\ProductTradeMeExtension;
+use Sunnysideup\Ecommerce\Model\Config\EcommerceDBConfig;
+use SilverStripe\Core\Extension;
+



@@ -48,7 +60,7 @@
   * EXP: you may want to add ownership (owns)
   * ### @@@@ STOP REPLACEMENT @@@@ ###
   */
-        'TradeMeImage' => 'Image',
+        'TradeMeImage' => Image::class,
     ];

     /**
@@ -153,7 +165,7 @@
                 $categoryID = $this->owner->getTradeMeCustomCategory($categoryID);
             }
         } else {
-            $categoryID = Config::inst()->get('TradeMeCategories', 'trade_me_default');
+            $categoryID = Config::inst()->get(TradeMeCategories::class, 'trade_me_default');
         }

         return $categoryID;
@@ -170,7 +182,7 @@
         $result = $this->owner->Title;
         $result = str_replace('&', ' and ', $result);
         if ($checkLimit) {
-            $limit = Config::inst()->get('ProductTradeMeExtension', 'trade_me_title_char_limit');
+            $limit = Config::inst()->get(ProductTradeMeExtension::class, 'trade_me_title_char_limit');
             $result = substr($result, 0, $limit - 1);
         }
         return (string) $result;
@@ -207,7 +219,7 @@

         //limit
         if ($checkLimit) {
-            $limit = $limit = Config::inst()->get('ProductTradeMeExtension', 'trade_me_title_description_limit');
+            $limit = $limit = Config::inst()->get(ProductTradeMeExtension::class, 'trade_me_title_description_limit');
             $result = substr($result, 0, $limit - 1);
         }


Warnings for src/Extensions/ProductTradeMeExtension.php:
 - src/Extensions/ProductTradeMeExtension.php:51 Renaming ambiguous string Image to SilverStripe\Assets\Image

 - src/Extensions/ProductTradeMeExtension.php:168 PhpParser\Node\NullableType
 - WARNING: New class instantiated by a dynamic value on line 168

 - src/Extensions/ProductTradeMeExtension.php:184 PhpParser\Node\NullableType
 - WARNING: New class instantiated by a dynamic value on line 184

modified:	_config/config.yml
@@ -3,17 +3,13 @@
 Before: 'app/*'
 After: 'framework/*','cms/*','ecommerce/*'
 ---
+Sunnysideup\Ecommerce\Pages\ProductGroup:
+  extensions:
+    - Sunnysideup\EcommerceTrademe\Extensions\ProductGroupTradeMeExtension
+Sunnysideup\Ecommerce\Pages\Product:
+  extensions:
+    - Sunnysideup\EcommerceTrademe\Extensions\ProductTradeMeExtension
+Sunnysideup\Ecommerce\Model\Config\EcommerceDBConfig:
+  extensions:
+    - Sunnysideup\EcommerceTrademe\Extensions\EcommerceConfigTradeMeExtension

-ProductGroup:
-  extensions:
-    - ProductGroupTradeMeExtension
-
-Product:
-  extensions:
-    - ProductTradeMeExtension
-
-
-EcommerceDBConfig:
-  extensions:
-    - EcommerceConfigTradeMeExtension
-

modified:	_config/routes.yml
@@ -3,6 +3,6 @@
 ---
 SilverStripe\Control\Director:
   rules:
-    'admin/set-trade-me-categories//$Action/$ID/$OtherID': 'TradeMeAssignGroupController'
-    'admin/set-trade-me-products//$Action/$ID/$OtherID': 'TradeMeAssignProductController'
+    admin/set-trade-me-categories//$Action/$ID/$OtherID: Sunnysideup\EcommerceTrademe\Control\TradeMeAssignGroupController
+    admin/set-trade-me-products//$Action/$ID/$OtherID: Sunnysideup\EcommerceTrademe\Control\TradeMeAssignProductController


Writing changes for 14 files
✔✔✔